$(document).ready(function(){function e(e,o,n){var r=[];for(var i in e)r.push('<input type="checkbox" name="SMFilter" value="'+e[i]+'">'+e[i]+"</input>");$("#SubjectiveMarkers").html(r.join("<br />")),$("#SubjectiveMarkers").on("click",function(){t(o,n)})}function t(e,t){p=[],$("input:checkbox[name=SMFilter]:checked").each(function(){p.push($(this).val())}),l=[],$("input:range-slider[name=PageFilter]:input change").each(function(){l.push($(this).val())}),n(e,t)}function o(e){var t=[],o=[],n=[],r=[];for(var i in e.features){var a=e.features[i].properties;void 0===o[a.Page]&&(t.push(a.Page),o[a.Page]=1),void 0===r[a.SM]&&(n.push(a.SM),r[a.SM]=1)}return{SMs:n,pages:t.sort(function(e,t){return e-t})}}function n(e,t){f.hasLayer(s)&&f.removeLayer(s),s=L.geoJson(t,{filter:function(e){return-1!==$.inArray(e.properties.SM,p)?!0:!1},pointToLayer:function(e,t){return L.circleMarker(t,{fillColor:r(e.properties.SM),color:r(e.properties.SM),weight:3,fillOpacity:.7}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#000000"})},mouseout:function(){this.closePopup(),this.setStyle({color:r(e.properties.SM)})}})}}).addTo(f),i()}function r(){return"#c897d9"}function i(){s.eachLayer(function(e){var t=e.feature.properties,o=a(t.SM),n="<i><b>"+t.SM+"</b></i> <br>"+t.Address+"<br>page "+t.Page;e.setRadius(o),e.bindPopup(n,{offset:new L.Point(0,-o)}),e.options.color=r(t.SM),e.options.fillColor=r(t.SM)})}function a(e){return 10}function u(e){var t=L.control({position:"bottomleft"});t.onAdd=function(){var t=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(t,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(t).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){i(e[$(this).val().toString()]),$(".temporal-legend").text(this.value)}),t},t.addTo(f),c(e[0])}function c(e){var t=L.control({position:"bottomleft"});t.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},t.addTo(f),$(".temporal-legend").text(e)}var s,p=[],l=[];L.mapbox.accessToken="pk.eyJ1Ijoic3poYW5nMjQ5IiwiYSI6Im9jN0UtRWMifQ.vCDJzEeXrVAIOFVLSD3Afg";var f=L.mapbox.map("map","szhang249.i6n0bn3j");f.setView([48.878,2.358],15),$.getJSON("data/Locationsv4.geojson").done(function(r){var i=o(r);n(i,r),u(i.pages),e(i.SMs,i,r),t(i,r)}).fail(function(){alert("There has been a problem loading the data.")}),console.log(pages)});